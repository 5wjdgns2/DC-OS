
1.	Universe 설정

1-1.	일반적인 Universe 생성 방법.

1-1-1.	메소스피어 Universe repository clone
git clone https://github.com/mesosphere/universe.git --branch version-3.x

1-1-2.	빌드 universe-base image
cd universe/docker/local-universe/
sudo make base

1-1-3.	이미지를 빌드하고 local-universe.tar.gz 파일로 압축
(DCOS_PACKAGE_INCLUDE 변수를 사용하여 쉼표로 구분 된 패키지 이름 및 버전 목록을 지정)
(DCOS_PACKAGE_INCLUDE 변수를 사용하지 않으면 선택한 모든 유니버스 패키지가 포함됩니다.)

make DCOS_VERSION=1.12 DCOS_PACKAGE_INCLUDE="marathon:1.7.188,marathon-lb:1.14.0,registry:2.5.1-0.2,edgelb:v1.4.0,edgelb-pool:v1.4.0,kubernetes-cluster:2.2.2-1.13.5,kubernetes:2.2.2-1.13.5" local-universe

1-1-4.	local-universe.tar.gz 압축 파일 생성 완료.

1-2.	EdgeLB 등 추가 universe 파일 생성 방법

-온라인시 직접 repo 추가
dcos package repo add --index=0 edgelb https://downloads.mesosphere.com/edgelb/v1.4.0/assets/stub-universe-edgelb.json
dcos package repo add --index=0 edgelb-pool https://downloads.mesosphere.com/edgelb-pool/v1.4.0/assets/stub-universe-edgelb-pool.json

1-2-1.	DCOS 홈페이지에서 Edge-LB api 서버 및 pool 패키지 버전 다운로드.(근철씨 계정)
위 Universe 설치와 동일한 폴더로 이동 

cd universe/docker/local-universe/
sudo make base

1-2-2. 아래 명령 실행하여 Edge-LB api 서버 패키지를 추가.
bash add-stub-universe.sh -j stub-universe-edgelb.json
bash add-stub-universe.sh -j stub-universe-edgelb-pool.json

1-2-3. 기존 패키지와 병합
cp -rpv stub-repo/packages/* ../../repo/packages

위 1-1-3. 명령어에 추가된 패키지 리스트 추가하여 local-universe  이미지 압축 파일 생성

1-3.	Universe 이미지 등록 방법 ( 멀티 마스터 시에도 모든 마스터 서버 동일 세팅)

1-3-1. 위에 생성한 local-universe 압축 파일 외에 아래 2개의 파일 다운 or 내부망시 미리 준비
curl -v https://raw.githubusercontent.com/mesosphere/universe/version-3.x/docker/local-universe/dcos-local-universe-http.service -o dcos-local-universe-http.service
curl -v https://raw.githubusercontent.com/mesosphere/universe/version-3.x/docker/local-universe/dcos-local-universe-registry.service -o dcos-local-universe-registry.service

1-3-2. 3개의 파일 전부 마스터 서버로 복사
dcos-local-universe-http.service  
dcos-local-universe-registry.service  
local-universe.tar.gz

1-3-3. systemd 설정
sudo mv dcos-local-universe-registry.service /etc/systemd/system/
sudo mv dcos-local-universe-http.service /etc/systemd/system/
ls -la /etc/systemd/system/dcos-local-universe-*

1-3-4. 마스터 서버 local docker 인스턴스에 Universe load
docker load < local-universe.tar.gz

1-3-5. 시스템 데몬 재시작
sudo systemctl daemon-reload

1-3-6. dcos-local-universe-http및 dcos-local-universe-registry서비스를 활성화하고 시작
sudo systemctl enable dcos-local-universe-http
sudo systemctl enable dcos-local-universe-registry
sudo systemctl start dcos-local-universe-http
sudo systemctl start dcos-local-universe-registry

1-3-7. 실행중인지 확인
sudo systemctl status dcos-local-universe-http
sudo systemctl status dcos-local-universe-registry

1-4.	Local Universe 마스터에 연결
1-4-1. 기존 저장소 제거
dcos package repo remove Universe

1-4-2. local-universe 저장소 추가
dcos package repo add local-universe http://master.mesos:8082/repo

1-4-3. 다음 명령을 사용하여 DC / OS 인증서 사본을 로컬로 다운로드하고 신뢰할 수 있는 것으로 설정 ( 모든 노드 세팅 필요 )
sudo mkdir -p /etc/docker/certs.d/master.mesos:5000
sudo curl -o /etc/docker/certs.d/master.mesos:5000/ca.crt http://master.mesos:8082/certs/domain.crt
sudo systemctl restart docker

1-4-4. 다운로드 한 Docker 인증서를 신뢰하도록 Apache Mesos 구성
sudo cp /etc/docker/certs.d/master.mesos:5000/ca.crt /var/lib/dcos/pki/tls/certs/docker-registry-ca.crt

1-4-5. 해시 생성
cd /var/lib/dcos/pki/tls/certs/
openssl x509 -hash -noout -in docker-registry-ca.crt

1-4-6. 해시 값으로 소프트 링크 생성
sudo ln -s /var/lib/dcos/pki/tls/certs/docker-registry-ca.crt /var/lib/dcos/pki/tls/certs/해시값입력.0



에러 내용 :
1.	https://master.mesos:5000/v1/_ping: x509: certificate signed by unknown authority (위 인증서 설치 부분 빠지면 문제 생김)
